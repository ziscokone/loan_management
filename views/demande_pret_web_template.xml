<?xml version="1.0" encoding="utf-8"?>
<odoo><!-- Erreur de matricule : Matricule inexistant dans la BD  -->
    <template id="matricule_error" name="Erreur Matricule">
        <t t-call="website.layout">
            <style>
            .background-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
                            url(&apos;/loan_mutual/static/src/img/paa.jpg&apos;) center/cover no-repeat;
                filter: blur(4px);
                z-index: -1;
            }

            .error-card {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(5px);
            }
        </style><!-- Background image container -->
            <div class="background-container"></div><!-- Main content -->
            <div class="d-flex align-items-center justify-content-center min-vh-100">
                <div class="card shadow-lg border-0 rounded-lg p-5 text-center error-card" style="max-width: 500px;">
                    <h5 class="card-title text-danger fw-bold mb-4" style="font-size: 1.5rem;">
                        <t t-esc="error"/>
                    </h5>
                    <div class="mt-4">
                        <a href="/verif-matricule" class="btn btn-success px-4 py-2">
                        Réessayer
                    </a>
                    </div>
                </div>
            </div>
        </t>
    </template><!-- Template  de vérification du matricule -->
    <template id="matricule_employee_verification" name="Vérification Employé">
        <t t-name="website.matricule_employee_verification">
            <t t-call="website.layout">
                <div class="o_portal_wrap min-vh-100 d-flex align-items-center position-relative"><!-- Background image avec flou -->
                    <div class="position-absolute w-100 h-100" style="top: 0; 
                            left: 0; 
                            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), 
                                      url(&apos;/loan_mutual/static/src/img/paa.jpg&apos;) center/cover no-repeat;
                            filter: blur(2px);
                            z-index: -1;"></div>
                    <div class="container o_website_form_container position-relative">
                        <div class="row justify-content-center">
                            <div class="col-12 col-sm-8 col-md-6 col-lg-4">
                                <div class="card shadow border-0 rounded-3">
                                    <div class="card-body p-3">
                                        <div class="text-center mb-3">
                                            <h6 class="text-muted">Entrez votre matricule pour continuer</h6>
                                        </div>
                                        <form t-attf-action="/pret-mutuel" method="post" class="o_website_form">
                                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                            <div class="mb-3">
                                                <input type="text" name="matricule" required="1" class="form-control" placeholder="Entrez votre matricule"/>
                                            </div>
                                            <button type="submit" class="btn btn-primary w-100" style="background-color:#0099CC">
                                            Continuer
                                        </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </t>
    </template><!-- Template du Formulaire de demande  -->
    <template id="loan_application_form" name="Formulaire de Demande de Prêt">
        <t t-call="website.layout">
            <div class="min-vh-100 o_loan_form_wrapper d-flex align-items-center" style="background: linear-gradient(135deg, #e6e9ff 0%, #d4d1f3 100%);">
                <div class="container py-5">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8">
                            <div class="card shadow-lg border-0 rounded-3">
                                <div class="card-header bg-primary text-white py-3 border-bottom-0" style="background-color:#0099CC">
                                    <h3 class="card-title text-center mb-0">
                                       Fiche de demande de prêt mutuel
                                   </h3>
                                </div>
                                <div class="card-body p-4">
                                    <form id="loanForm" t-attf-action="/demande-pret/preview" method="post" class="needs-validation" enctype="multipart/form-data" novalidate="1">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/><!-- Campagne et Matricule -->
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <i class="fa fa-calendar me-2"/>Campagne
                                               </label>
                                                <input type="text" class="form-control" t-att-value="campaign.name" readonly="1"/>
                                                <input type="hidden" name="campaign_id" t-att-value="campaign.id"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <i class="fa fa-id-card me-2"/>Matricule 
                                               </label>
                                                <div class="input-group">
                                                    <input type="text" t-att-value="employee.matricule" name="matricule" class="form-control" readonly="1" placeholder="Votre matricule"/>
                                                </div>
                                            </div>
                                        </div><!-- Informations personnelles -->
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <i class="fa fa-user me-2"/>Nom 
                                               </label>
                                                <input type="text" id="nom" t-att-value="employee.name" name="nom" class="form-control" readonly="1"/>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <i class="fa fa-user me-2"/>Prénoms 
                                               </label>
                                                <input type="text" id="prenoms" t-att-value="employee.prenoms" name="prenoms" class="form-control" readonly="1"/>
                                            </div>
                                        </div><!-- Informations complémentaires -->
                                        <div class="row mb-4">
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-venus-mars me-2"/>Sexe
                                               </label>
                                                <input type="text" id="sexe" name="sexe" t-att-value="employee.sexe" readonly="1" class="form-control"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-sitemap me-2"/>Direction
                                               </label>
                                                <input type="text" id="direction" t-att-value="employee.nom_direction" readonly="1" name="direction" class="form-control"/>
                                                <input type="hidden" id="age" name="age" t-att-value="employee.age" readonly="1" class="form-control"/>
                                                <input type="hidden" id="anciennete" name="anciennete" t-att-value="employee.anciennete" readonly="1" class="form-control"/>
                                                <input type="hidden" name="employee_id" t-att-value="employee.id"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-building me-2"/>Catégorie
                                               </label>
                                                <input type="text" id="typecategorie" t-att-value="employee.typecat" readonly="1" name="typecategorie" class="form-control"/>
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-phone me-2"/>Téléphone <span style="color:red;"> *</span>
                                                </label>
                                                <input type="number" id="telephone" name="telephone" class="form-control" maxlength="10" placeholder="Ex: 0701020304" required="required" t-att-value="request.params.get(&apos;telephone&apos;)" oninput="this.value = this.value.replace(/[^0-9]/g, &apos;&apos;); if (this.value.length &gt; this.maxLength) this.value = this.value.slice(0, this.maxLength); if (parseInt(this.value) &lt; 0) this.value = &apos;&apos;;"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-phone me-2"/>Téléphone 2 
                                               </label>
                                                <input type="number" id="telephone_2" name="_2" class="form-control" maxlength="10" placeholder="Ex: 0701020304" required="required" t-att-value="request.params.get(&apos;telephone&apos;)" oninput="this.value = this.value.replace(/[^0-9]/g, &apos;&apos;); if (this.value.length &gt; this.maxLength) this.value = this.value.slice(0, this.maxLength); if (parseInt(this.value) &lt; 0) this.value = &apos;&apos;;"/>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">
                                                    <i class="fa fa-building me-2"/>Modalité de remboursement <span style="color:red;"> *</span>
                                                </label>
                                                <select id="modalite_remboursement" name="modalite_remboursement" class="form-control" required="required">
                                                    <option value="">-- Sélectionnez une durée --</option>
                                                    <option value="10">10 mois</option>
                                                    <option value="9">9 mois</option>
                                                    <option value="8">8 mois</option>
                                                    <option value="7">7 mois</option>
                                                    <option value="6">6 mois</option>
                                                    <option value="5">5 mois</option>
                                                    <option value="4">4 mois</option>
                                                    <option value="3">3 mois</option>
                                                    <option value="3">2 mois</option>
                                                    <option value="3">1 mois</option>
                                                </select>
                                            </div>
                                        </div><!-- EMAIL -->
                                        <div class="row mb-4">
                                            <div class="col-md-6">
                                                <label class="form-label">
                                                    <i class="fa fa-envelope me-2"></i>Email 
                                                </label>
                                                <input type="email" id="email" name="email" class="form-control" placeholder="Ex: exemple@mail.com" t-att-value="request.params.get(&apos;email&apos;)" pattern="[^@]+@[^@]+\.[a-zA-Z]{2,}"/>
                                            </div><!-- PIECE IDENTITE -->
                                            <div class="col-6">
                                                <label class="form-label">
                                                    <i class="fa fa-file-pdf me-2"/>Pièce Identité (CNI ou Permis) <span style="color:red;"> *</span>
                                                </label>
                                                <div class="input-group">
                                                    <input type="file" id="justificatif" name="justificatif" class="form-control" accept=".jpg,.jpeg,.png" required="required"/>
                                                </div>
                                            </div>
                                        </div><!-- TYPE DE PRET ET MONTANT DEMANDE  -->
                                        <div class="row mb-4">
                                            <div class="col-4">
                                                <label class="form-label">
                                                    <i class="fa fa-clock-o me-2"/>Type de Prêt <span style="color:red;"> *</span>
                                                </label>
                                                <select id="type_pret" name="type_pret" class="form-control" required="required">
                                                    <option value="">-- Sélectionnez un type de prêt --</option>
                                                    <option value="credits_express" selected="selected">CREDIT EXPRESS</option>
                                                    <option value="credits_projets">CREDIT PROJETS</option>
                                                </select>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="form-label">
                                                    <i class="fa fa-money me-2"/>Montant Demandé (FCFA) <span style="color:red;">*</span>
                                                </label>
                                                <div class="input-group">
                                                    <input type="text" id="amount_requested_display" class="form-control" required="1" t-att-data-initial-value="request.params.get(&apos;amount_requested&apos;)" placeholder="Montant de prêt limité à 1 500 000 FCFA" oninput="formatAmount(this)"/>
                                                    <input type="hidden" id="amount_requested" name="amount_requested" t-att-value="request.params.get(&apos;amount_requested&apos;)"/>
                                                    <span class="input-group-text">FCFA</span>
                                                </div>
                                            </div>
                                        </div><!-- Motif de la demande -->
                                        <div class="row mb-4">
                                            <div class="col-12">
                                                <label class="form-label">
                                                    <i class="fa fa-comment me-2"/>Motif de la demande <span style="color:red;"> *</span>
                                                </label>
                                                <textarea id="motif_demande" name="motif_demande" class="form-control" rows="3" required="required" placeholder="Veuillez expliquer le motif de votre demande de prêt..."></textarea>
                                            </div>
                                        </div><!-- Bouton de soumission -->
                                        <div class="text-center mt-4">
                                            <button type="submit" class="btn btn-primary px-5 py-2" style="background-color:#0099CC">
                                                <i class="fa fa-paper-plane me-2"/>Soumettre la demande
                                           </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- LE SCRIPT DU SEPARATEUR DES MILLIERS   ET VALIDATION DE MAIL -->
            <script>
                        function formatAmount(input) {
                            // Supprimer tout sauf les chiffres
                            let value = input.value.replace(/\D/g, &apos;&apos;);
                            
                            // Limiter à 7 chiffres
                            if (value.length &gt; 7) {
                                value = value.slice(0, 7);
                            }
                            
                            // Convertir en nombre
                            let num = parseInt(value, 10);

                            // Vérifier si le nombre dépasse 1 500 000
                            if (!isNaN(num)) {
                                if (num &gt; 1500000) {
                                    alert(&quot;Toute demande excédant 1 500 000 FCFA nécessite un passage obligatoire au secrétariat.&quot;);
                                }

                                // Limiter à 1 500 000
                                num = Math.min(num, 1500000);

                                // Formater avec le séparateur de milliers
                                input.value = num.toLocaleString(&apos;fr-FR&apos;);
                                // Mettre à jour le champ caché avec la valeur non formatée
                                document.getElementById(&apos;amount_requested&apos;).value = num;
                            } else {
                                input.value = &apos;&apos;;
                                document.getElementById(&apos;amount_requested&apos;).value = &apos;&apos;;
                            }
                        }

                        // Formater la valeur initiale si elle existe
                        document.addEventListener(&apos;DOMContentLoaded&apos;, function() {
                            const display = document.getElementById(&apos;amount_requested_display&apos;);
                            const initialValue = display.dataset.initialValue;
                            if (initialValue) {
                                let num = parseInt(initialValue, 10);
                                if (!isNaN(num)) {
                                    if (num &gt; 1500000) {
                                        num = 1500000; // Limiter à 1 500 000
                                    }
                                    display.value = num.toLocaleString(&apos;fr-FR&apos;);
                                    document.getElementById(&apos;amount_requested&apos;).value = num;
                                }
                            }
                        });

                </script>
        </t>
    </template>
</odoo>